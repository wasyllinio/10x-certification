<div class="chargers-list-container">
  <!-- Page Title -->
  <div class="page-header mb-4">
    <h1 class="page-title">
      <i class="pi pi-plug mr-2"></i>
      Stacje Ładowania
    </h1>
  </div>

  <!-- Toolbar with filters -->
  <p-card styleClass="mb-4">
    <p-toolbar styleClass="p-component">
      <div class="p-toolbar-group-start">
        <p-button 
          label="Dodaj stację" 
          icon="pi pi-plus"
          severity="primary"
          (click)="navigateToNew()">
        </p-button>
      </div>

      <div class="p-toolbar-group-end">
        <!-- Search Input -->
        <span class="p-input-icon-left mr-3">
          <i class="pi pi-search"></i>
          <input 
            type="text" 
            pInputText 
            placeholder="Szukaj..."
            [value]="searchText()"
            (input)="onSearchChange($any($event.target).value)"
            appDebounce
            styleClass="w-full md:w-auto">
        </span>

        <!-- Status Filter -->
        <p-select
          [options]="statusOptions"
          [(ngModel)]="statusFilter"
          optionLabel="label"
          optionValue="value"
          placeholder="Status"
          styleClass="w-10rem mr-3">
        </p-select>

        <!-- Clear Filters -->
        @if (activeFiltersCount > 0) {
          <p-button 
            label="Wyczyść" 
            icon="pi pi-filter-slash"
            severity="secondary"
            [text]="true"
            (click)="clearFilters()">
          </p-button>
        }
      </div>
    </p-toolbar>
  </p-card>

  <!-- Badge with active filters count -->
  @if (activeFiltersCount > 0) {
    <div class="mb-4">
      <p-badge [value]="'Aktywnych filtrów: ' + activeFiltersCount" severity="info"></p-badge>
    </div>
  }

  <!-- Main Content Card -->
  <p-card>
    <!-- Loading State -->
    @if (loading()) {
      <div class="flex justify-content-center align-items-center py-8">
        <p-progressSpinner></p-progressSpinner>
      </div>
    }

    <!-- Table -->
    @if (!loading()) {
      <p-table
      [value]="chargers()"
      [paginator]="true"
      [rows]="itemsPerPage()"
      [first]="(currentPage() - 1) * itemsPerPage()"
      [totalRecords]="pagination().total"
      [rowsPerPageOptions]="[20, 50, 100]"
      [lazy]="true"
      (onLazyLoad)="onPageChange($event)"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Wyświetlanie {first} - {last} z {totalRecords} stacji"
      [rowHover]="true"
      [scrollable]="true"
      ariaLabel="Lista stacji ładowania">
      
      <!-- Table Headers -->
      <ng-template pTemplate="header">
        <tr role="row">
          <th role="columnheader" style="width: 20%">Vendor</th>
          <th role="columnheader" style="width: 20%">Model</th>
          <th role="columnheader" style="width: 20%">Numer seryjny</th>
          <th role="columnheader" style="width: 15%">Status</th>
          <th role="columnheader" style="width: 10%">Connectors</th>
          <th role="columnheader" style="width: 15%">Akcje</th>
        </tr>
      </ng-template>

      <!-- Table Body -->
      <ng-template pTemplate="body" let-charger>
        <tr role="row" (click)="viewCharger(charger.id)">
          <td role="gridcell">{{ charger.vendor }}</td>
          <td role="gridcell">{{ charger.model }}</td>
          <td role="gridcell">{{ charger.serial_number }}</td>
          <td role="gridcell">
            <span 
              class="p-badge"
              [class]="'p-badge-' + getStatusSeverity(charger.location_id)"
              [attr.aria-label]="'Status: ' + getStatusLabel(charger.location_id)">
              {{ getStatusLabel(charger.location_id) }}
            </span>
          </td>
          <td role="gridcell">
            <span class="p-badge p-component" [attr.aria-label]="'Liczba connectorów: ' + getConnectorCount(charger)">
              {{ getConnectorCount(charger) }}
            </span>
          </td>
          <td role="gridcell">
            <div class="flex gap-2" role="group" aria-label="Akcje stacji">
              <p-button 
                icon="pi pi-eye" 
                size="small"
                [text]="true"
                [attr.aria-label]="'Wyświetl stację ' + charger.vendor + ' ' + charger.model"
                (click)="viewCharger(charger.id); $event.stopPropagation()"
                type="button">
              </p-button>
              <p-button 
                icon="pi pi-pencil" 
                size="small"
                [text]="true"
                [attr.aria-label]="'Edytuj stację ' + charger.vendor + ' ' + charger.model"
                (click)="editCharger(charger.id, $event)"
                type="button">
              </p-button>
              <p-button 
                icon="pi pi-trash" 
                size="small"
                severity="danger"
                [text]="true"
                [attr.aria-label]="'Usuń stację ' + charger.vendor + ' ' + charger.model"
                (click)="deleteCharger(charger.id, $event)"
                type="button">
              </p-button>
            </div>
          </td>
        </tr>
      </ng-template>

      <!-- Empty State -->
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center py-6">
            <div class="flex flex-column align-items-center gap-3">
              <i class="pi pi-inbox text-5xl text-400"></i>
              <h3 class="m-0 text-500">Brak stacji ładowania</h3>
              <p-button 
                label="Dodaj pierwszą stację" 
                icon="pi pi-plus"
                (click)="navigateToNew()">
              </p-button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
    }
  </p-card>

  <!-- Toast for messages -->
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>
</div>

